---
- name: Ensure keyrings directory exists
  ansible.builtin.file:
    path: /usr/share/keyrings
    state: directory
    mode: '0755'

- name: Download and install VitexSoftware GPG key
  ansible.builtin.get_url:
    url: http://repo.vitexsoftware.com/KEY.gpg
    dest: /usr/share/keyrings/vitexsoftware-archive-keyring.gpg
    mode: '0644'
    force: false

- name: Ensure VitexSoftware APT repository is present (DEB822) for suite "{{ apt_vitexsoftware_suite }}"
  ansible.builtin.template:
    src: vitexsoftware.sources.j2
    dest: "/etc/apt/sources.list.d/vitexsoftware-{{ apt_vitexsoftware_suite }}.sources"
    owner: root
    group: root
    mode: '0644'
  vars:
    suite: "{{ apt_vitexsoftware_suite }}"
    components: "{{ apt_vitexsoftware_components | join(' ') }}"
  tags: [repo, deb822]

- name: Update APT cache
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: 3600
